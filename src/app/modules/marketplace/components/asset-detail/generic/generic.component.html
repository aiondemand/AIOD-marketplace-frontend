<div *ngFor="let item of items">
  <div *ngFor="let col of columns" class="item-info-body">
    <!-- Column Container -->
    <div
      *ngIf="shouldShowColumn(col, item)"
      class="item-info-container col"
      [ngClass]="getThemeClass()"
    >
      <h3>{{ formatColumnName(col) }}</h3>

      <div>
        <!-- Array Type -->
        <div *ngIf="isArrayType(col, item)">
          <span *ngFor="let arrayItem of getArrayValues(item[col]); let last = last">
            {{ arrayItem }}<span *ngIf="!last">, </span>
          </span>
        </div>

        <!-- Distribution Type -->
        <div *ngIf="isDistributionType(col)">
          <!-- Distribution Dependency -->
          <div *ngIf="getDistributionDependency()" [ngClass]="getDistributionItemClass()">
            <strong>Dependency:</strong> {{ getDistributionDependency() }}
          </div>
          <!-- Distribution Grid -->
          <div class="distribution-grid">
            <div *ngFor="let dist of item[col]" class="distribution-entry">
              <div *ngIf="dist.name" [ngClass]="getDistributionItemClass()">
                <strong>Name:</strong> {{ dist.name }}
              </div>
              <div *ngIf="dist.description" [ngClass]="getDistributionItemClass()">
                <strong>Description:</strong> {{ dist.description }}
              </div>
              <div *ngIf="dist.content_url" [ngClass]="getDistributionItemClass()">
                <strong>URL:</strong>
                <a style="color: #41b6e6" [href]="dist.content_url" target="_blank">
                  {{ dist.content_url }}
                </a>
              </div>
              <div *ngIf="dist.encoding_format" [ngClass]="getDistributionItemClass()">
                <strong>Encoding Format:</strong> {{ dist.encoding_format }}
              </div>
              <div *ngIf="dist.checksum" [ngClass]="getDistributionItemClass()">
                <strong>Checksum:</strong> {{ dist.checksum }}
              </div>
              <div *ngIf="dist.checksum_algorithm" [ngClass]="getDistributionItemClass()">
                <strong>Checksum Algorithm:</strong> {{ dist.checksum_algorithm }}
              </div>
            </div>
          </div>
        </div>

        <!-- Object Array Type (Media) -->
        <div *ngIf="isObjectArrayType(col, item)" class="object-array-media">
          <div *ngFor="let obj of item[col]" class="media-card">
            <h3 class="media-title">{{ getDistributionName() }}</h3>

            <div class="media-content">
              <!-- Description Section -->
              <div
                *ngIf="obj.description"
                class="media-section"
                role="button"
                tabindex="0"
                (click)="toggleState(obj, 'showDescription')"
                (keydown.enter)="toggleState(obj, 'showDescription')"
                (keydown.space)="$event.preventDefault(); toggleState(obj, 'showDescription')"
                style="cursor: pointer"
              >
                <div class="media-header" style="display: flex; align-items: center; justify-content: space-between; width: 100%">
                  <span class="media-desc-label">Description</span>
                  <mat-icon
                    class="media-desc-arrow"
                    [attr.aria-label]="getExpandIconLabel(obj.showDescription)"
                    [style.transform]="getExpandIconTransform(obj.showDescription)"
                    [style.transition]="'transform 180ms ease'"
                    [style.color]="'#5bc0f7'"
                  >
                    expand_more
                  </mat-icon>
                </div>
                <div class="dropdown-content" [ngClass]="{ 'animate-dropdown': obj.showDescription }">
                  <p class="media-description">{{ obj.description }}</p>
                </div>
              </div>

              <!-- Properties Section -->
              <div
                *ngIf="hasMediaProperties(obj)"
                class="media-section"
                role="button"
                tabindex="0"
                (click)="toggleState(obj, 'showProperties')"
                (keydown.enter)="toggleState(obj, 'showProperties')"
                (keydown.space)="$event.preventDefault(); toggleState(obj, 'showProperties')"
                style="cursor: pointer"
              >
                <div class="media-header" style="display: flex; align-items: center; justify-content: space-between; width: 100%">
                  <span class="media-properties-label">Properties</span>
                  <mat-icon
                    class="media-properties-arrow"
                    [attr.aria-label]="getExpandIconLabel(obj.showProperties)"
                    [style.transform]="getExpandIconTransform(obj.showProperties)"
                    [style.transition]="'transform 180ms ease'"
                    [style.color]="'#5bc0f7'"
                  >
                    expand_more
                  </mat-icon>
                </div>

                <!-- Properties List -->
                <div class="media-properties-list dropdown-content" [ngClass]="{ 'animate-dropdown': obj.showProperties }">
                  <div *ngIf="obj.checksum_algorithm" class="media-property" [ngClass]="getThemeClass()">
                    <div class="media-property-value">{{ obj.checksum_algorithm }}</div>
                    <div class="media-property-label">Checksum Algorithm</div>
                  </div>
                  <div *ngIf="obj.content_size_kb" class="media-property" [ngClass]="getThemeClass()">
                    <div class="media-property-value">{{ obj.content_size_kb }}</div>
                    <div class="media-property-label">Content size (KB)</div>
                  </div>
                  <div *ngIf="obj.content_url" class="media-property" [ngClass]="getThemeClass()">
                    <div class="media-property-value">
                      <a [href]="obj.content_url" target="_blank">{{ obj.content_url }}</a>
                    </div>
                    <div class="media-property-label">Content URL</div>
                  </div>
                  <div *ngIf="obj.copyright" class="media-property" [ngClass]="getThemeClass()">
                    <div class="media-property-value">{{ obj.copyright }}</div>
                    <div class="media-property-label">Copyright</div>
                  </div>
                  <div *ngIf="obj.date_published" class="media-property" [ngClass]="getThemeClass()">
                    <div class="media-property-value">{{ obj.date_published }}</div>
                    <div class="media-property-label">Date Published</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Source Link -->
            <div style="padding-top: 2rem">
              <a *ngIf="obj.content_url" [href]="obj.content_url" style="color: #41b6e6" target="_blank">
                <mat-icon style="vertical-align: middle; font-size: 16px; height: unset">open_in_new</mat-icon>
                <span style="margin-left: 6px; vertical-align: middle">Source</span>
              </a>
            </div>
          </div>
        </div>

        <!-- Special Column Types with Markdown -->
        <markdown *ngIf="col === 'description'" class="markdown-white">
          {{ getDescription(item) }}
        </markdown>

        <markdown *ngIf="col === 'license'" class="license" style="color: blue">
          {{ item[col] }}
        </markdown>

        <markdown *ngIf="col === 'same_as'" class="same_as">
          {{ item[col] }}
        </markdown>

        <markdown *ngIf="col === 'execution_settings'" class="execution_settings" [ngClass]="getThemeClass()">
          {{ item[col] }}
        </markdown>

        <div *ngIf="col === 'badge'">
          <markdown
            *ngFor="let badgeItem of getArrayValues(item[col])"
            class="badge"
            [ngClass]="getThemeClass()"
          >
            {{ badgeItem }}
          </markdown>
        </div>
        <markdown *ngIf="col === 'type'" class="badge">
          {{ item[col] }}
        </markdown>
      </div>
    </div>
  </div>
</div>
